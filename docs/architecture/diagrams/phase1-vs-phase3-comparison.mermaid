graph TB
    subgraph "Phase 1: Simple POC"
        P1Client[Client] -->|Single File| P1API[API Gateway]
        P1API --> P1Lambda[Lambda<br/>5 min timeout]
        P1Lambda --> P1Analyzer[Code Analyzer]
        P1Lambda --> P1Claude[Claude Client]
        P1Claude -->|Every Request| P1Anthropic[Claude API<br/>$$]
        P1Lambda --> P1Cost[Cost Tracker]
        
        style P1Lambda fill:#ffcccc
        style P1Anthropic fill:#ffcccc
    end

    subgraph "Phase 3: Production System"
        P3Client[Client] -->|Batch/Single| P3API[API Gateway]
        P3API --> P3Lambda[Lambda Router<br/>Fast decisions]
        
        P3Lambda --> P3Cache{Cache<br/>Hit?}
        P3Cache -->|Yes| P3Return1[Return<br/>Cached Docs<br/>$0]
        P3Cache -->|No| P3Size{File<br/>Size?}
        
        P3Size -->|Small| P3LambdaProc[Lambda<br/>Processor]
        P3Size -->|Large| P3Queue[SQS Queue]
        P3Queue --> P3ECS[ECS Fargate<br/>Parallel Processing]
        
        P3LambdaProc --> P3Chunk[Chunking<br/>Strategy]
        P3ECS --> P3Chunk
        
        P3Chunk --> P3RateLimit[Rate Limiter<br/>+ Retry Logic]
        P3RateLimit --> P3ClaudeClient[Claude Client]
        P3ClaudeClient --> P3Anthropic[Claude API<br/>$]
        
        P3Anthropic --> P3UpdateCache[Update<br/>DynamoDB Cache]
        P3UpdateCache --> P3S3[Store in S3]
        P3S3 --> P3Return2[Return Docs]
        
        P3Lambda --> P3Monitor[CloudWatch<br/>+ X-Ray]
        
        style P3Cache fill:#ccffcc
        style P3Return1 fill:#ccffcc
        style P3RateLimit fill:#ccffcc
        style P3Chunk fill:#ccffcc
    end

    subgraph "Key Differences"
        D1[❌ No Caching<br/>Every call costs money]
        D2[✅ 80% Cache Hit Rate<br/>Massive cost savings]
        
        D3[❌ No Chunking<br/>Large files timeout]
        D4[✅ Smart Chunking<br/>Handles 50K+ lines]
        
        D5[❌ No Retry Logic<br/>Failures are final]
        D6[✅ Exponential Backoff<br/>Handles rate limits]
        
        D7[❌ Serial Processing<br/>One file at a time]
        D8[✅ Parallel Processing<br/>10x faster on repos]
    end

    style D1 fill:#ffcccc
    style D3 fill:#ffcccc
    style D5 fill:#ffcccc
    style D7 fill:#ffcccc
    
    style D2 fill:#ccffcc
    style D4 fill:#ccffcc
    style D6 fill:#ccffcc
    style D8 fill:#ccffcc
