sequenceDiagram
    participant Client
    participant APIGW as API Gateway
    participant Lambda as Lambda Handler
    participant Analyzer as CodeAnalyzer
    participant Claude as ClaudeClient
    participant Anthropic as Claude API
    participant Cost as CostTracker
    participant CW as CloudWatch

    Note over Client,CW: Phase 1: Single File Documentation Request

    Client->>APIGW: POST /document<br/>{file_path, file_content}
    activate APIGW
    
    APIGW->>Lambda: Invoke with event
    activate Lambda
    
    Lambda->>CW: Log: Request received (req_id)
    
    Note over Lambda: Extract & validate input
    Lambda->>Lambda: Parse JSON body
    Lambda->>Lambda: Validate .py extension
    
    Lambda->>Analyzer: analyze_file(path, content)
    activate Analyzer
    
    Note over Analyzer: AST Parsing
    Analyzer->>Analyzer: Count lines
    Analyzer->>Analyzer: Parse AST tree
    Analyzer->>Analyzer: Extract functions
    Analyzer->>Analyzer: Extract classes
    Analyzer->>Analyzer: Extract imports
    
    Analyzer-->>Lambda: FileAnalysis object
    deactivate Analyzer
    
    Lambda->>CW: Log: Analysis complete (N elements)
    
    Lambda->>Claude: generate_documentation(code, path)
    activate Claude
    
    Claude->>Claude: Build prompt with code
    
    Claude->>Anthropic: messages.create()<br/>model: sonnet-4<br/>max_tokens: 4096
    activate Anthropic
    
    Note over Anthropic: LLM Processing
    Anthropic->>Anthropic: Process prompt
    Anthropic->>Anthropic: Generate documentation
    
    Anthropic-->>Claude: Response:<br/>- documentation text<br/>- input_tokens<br/>- output_tokens
    deactivate Anthropic
    
    Claude->>Claude: Extract documentation
    Claude->>Claude: Calculate cost
    
    Claude-->>Lambda: (documentation, CostMetrics)
    deactivate Claude
    
    Lambda->>Cost: add_cost(file_path, metrics)
    activate Cost
    Cost->>Cost: Update totals
    Cost->>CW: Log: Cost summary
    Cost-->>Lambda: Acknowledgment
    deactivate Cost
    
    Lambda->>Lambda: Build DocumentationResult
    Lambda->>Lambda: Calculate processing time
    
    Lambda->>CW: Log: Request complete (time, cost)
    
    Lambda-->>APIGW: HTTP 200<br/>{success, data, message}
    deactivate Lambda
    
    APIGW-->>Client: JSON Response:<br/>- documentation<br/>- cost: $0.XX<br/>- tokens: N<br/>- time: Xs
    deactivate APIGW
    
    Note over Client: Documentation received!<br/>Ready to use
